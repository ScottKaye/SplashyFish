var splashyfish=function(e){function t(e){this.direction=V++%2===0?"up":"down",this.length=e,this.x=m}function n(){setTimeout(function(){if(v&&T){var e=f(0,w-E);M.push(new t(e)),M.push(new t(w-e-E))}n()},I)}function a(){n(),L.image=document.createElement("img"),L.image.src="img/sprites.png"}function l(){v&&!L.dead&&(T=!0,L.yVel=8,c("jump.mp3"))}function o(){M=[],P=0,v=!0,L.dead=!1,T=!1,L.yVel=0,L.y=w/2,L.x=m/4,L.angle=0,C=[{x:L.x,y:L.y}],S=!1}function f(e,t){return Math.floor(Math.random()*(t-e+1))+e}function d(e,t,n,i){var a=x.fillStyle;x.beginPath(),x.arc(e,t,n,0,2*Math.PI,!1),x.fillStyle=i,x.fill(),x.fillStyle=a}function r(e,t,n,i,a){var l=x.fillStyle;x.fillStyle=i,x.font=a+"px 'Press Start 2P'",x.fillText(e,t,n),x.fillStyle=l}function y(e,t){L.dead||(L.angle=2*L.yVel);var n=L.wings?0:240;x.translate(e,t),x.rotate(L.angle*Math.PI/180),x.drawImage(L.image,n,0,240,240,-16,-16,32,32),x.rotate(-L.angle*Math.PI/180),x.translate(-e,-t)}function c(e){var t="snd/"+e,n=new Audio(t);n.addEventListener("loadedmetadata",function(){n.play()},!1)}function s(){L.yVel=-1,L.dead=!0}var e=document.getElementById(e);e.width=window.innerWidth,e.height=400;var h,u,g,x=e.getContext("2d"),m=e.width,w=e.height,p=50,v=!0,S=!1,V=0,E=200,I=1e3,P=0,T=!1,k="Splashy Fish!",b="Click or Tap Spacebar to Dive!",L={x:m/4,y:w/2,yVel:0,image:null,wings:!0,speed:5,angle:0,dead:!1},M=[],C=[{x:L.x,y:L.y}];setInterval(function(){L.wings=L.dead?!0:!L.wings},100),setInterval(function(){S&&C.push({x:L.x,y:L.y})},25),a(),e.addEventListener("mousedown",function(e){1===e.which?l():2===e.which&&(C=[{x:L.x,y:L.y}],v=!0,S=!S)},!1),window.addEventListener("keydown",function(e){32===e.which&&l(),13===e.which&&o()},!1),e.addEventListener("mousemove",function(e){h=e.x,u=e.y},!1),function A(){if(requestAnimationFrame(A),v){var e=x.createLinearGradient(0,0,0,w);e.addColorStop(0,"#2980b9"),e.addColorStop(1,"#34495e"),x.fillStyle=e,x.fillRect(0,0,m,w);var t=L.y-16,n=L.y+16,a=L.x+16,l=L.x-16;if(S){for(x.beginPath(),x.moveTo(C[0].x,C[0].y),i=0;i<C.length-2;i++)if(C[i].x<=-10)C.splice(C.indexOf(C[i]),1);else{var o=(C[i].x+C[i+1].x)/2,f=(C[i].y+C[i+1].y)/2;x.lineTo(C[i].x,C[i].y,o,f),T&&!L.dead&&(C[i].x-=L.speed)}x.lineWidth=3,x.strokeStyle="#ff0000",x.stroke()}x.fillStyle="#27ae60",M.forEach(function(e){if(e.x>=0-p){var i;switch(e.direction){default:case"up":i=w-e.length;break;case"down":i=0}x.fillRect(e.x,i,p,e.length),a>=e.x&&l<e.x+p&&(clearTimeout(g),g=setTimeout(function(){P+=100},100),("down"===e.direction&&t<=e.length||"up"===e.direction&&n>=w-e.length)&&s()),L.dead||(e.x-=L.speed)}}),y(L.x,L.y),r(P,m-24*P.toString().length-32,64,"#ffffff",24),T||(r(k,m/2-24*k.toString().length,64,"#ffffff",24),r(b,m/2-640,240,"#ffffff",16)),S&&(d(L.x,t,2,"yellow"),d(L.x,n,2,"cyan"),d(l,L.y,2,"pink"),d(a,L.y,2,"lime")),T||L.dead?(L.y+=L.yVel,L.yVel=L.yVel/.981-.5):(L.y=L.y,L.yVel=0),(0>=t||n>=w)&&s(),0>=t&&L.dead&&(L.y=16,L.yVel=0,L.angle=180)}}()};